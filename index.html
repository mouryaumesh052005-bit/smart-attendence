<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Attendance System</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js"></script>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 0;
    }
    header {
      background: #4a90e2;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .container {
      max-width: 1000px;
      margin: 2rem auto;
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
    h2 {
      margin-bottom: 1rem;
      color: #333;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 2rem;
    }
    input {
      padding: 0.8rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }
    button {
      padding: 0.8rem;
      background: #4a90e2;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: 0.3s;
    }
    button:hover {
      background: #357ab8;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 0.8rem;
      text-align: center;
    }
    th {
      background: #f0f0f0;
    }
    .tick {
      color: green;
      font-weight: bold;
    }
    .cross {
      color: red;
      font-weight: bold;
    }
    .entry-badge {
      color: #4a90e2;
      font-weight: bold;
    }
    .exit-badge {
      color: #ff9800;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header>üìã Smart Attendance System</header>
  <div class="container" id="student-section" style="display:none;">
    <h2>üéì Student Attendance</h2>
    <form onsubmit="markAttendance(); return false;">
      <input type="text" id="name" placeholder="Enter Your Name" required>
      <input type="text" id="roll" placeholder="Enter Roll Number" required>
      <button type="submit">Submit Attendance</button>
    </form>
  </div>

  <div class="container" id="teacher-section" style="display:none;">
    <h2>üë®‚Äçüè´ Teacher Dashboard</h2>
    <table id="attendance-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Roll</th>
          <th>Entry</th>
          <th>Exit</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // ====== FIREBASE CONFIG (Replace with your own) ======
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_APP.firebaseapp.com",
      databaseURL: "https://YOUR_APP-default-rtdb.firebaseio.com",
      projectId: "YOUR_APP",
      storageBucket: "YOUR_APP.appspot.com",
      messagingSenderId: "1234567890",
      appId: "1:1234567890:web:abcdef12345"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ===== Mode Check (Student / Teacher) =====
    const urlParams = new URLSearchParams(window.location.search);
    let mode = urlParams.get("mode");
    if(mode==="student"){
      document.getElementById("student-section").style.display="block";
    } else if(mode==="teacher"){
      document.getElementById("teacher-section").style.display="block";
      loadAttendance();
    }

    // ===== Student Attendance Submit =====
    function markAttendance(){
      let name = document.getElementById("name").value.trim();
      let roll = document.getElementById("roll").value.trim();
      if(!name || !roll){alert("‚ùå Fill all details"); return;}

      let time = new Date().toISOString();
      let studentRef = db.ref("attendance/" + roll);

      studentRef.once("value").then(snapshot=>{
        if(snapshot.exists()){
          let data = snapshot.val();
          if(!data.exit){
            studentRef.update({
              exit: time,
              status: "Present"
            });
            alert("‚úÖ Exit Successful");
          } else {
            alert("‚Ñπ Already Submitted");
          }
        } else {
          studentRef.set({
            name: name,
            roll: roll,
            entry: time,
            exit: "",
            status: "Pending"
          });
          alert("‚úÖ Entry Successful");
        }
      });

      document.getElementById("name").value="";
      document.getElementById("roll").value="";
    }

    // ===== Teacher Dashboard (Realtime Attendance) =====
    function loadAttendance(){
      let tbody = document.querySelector("#attendance-table tbody");
      if(!tbody) return;

      db.ref("attendance").on("value", snapshot=>{
        tbody.innerHTML="";
        let now = new Date();

        snapshot.forEach(child=>{
          let s = child.val();

          // Absent rule (1 hour without exit)
          if(s.status==="Pending"){
            let entryTime = new Date(s.entry);
            let diff = (now - entryTime)/(1000*60*60);
            if(diff >= 1){
              db.ref("attendance/"+s.roll).update({status:"Absent"});
              s.status="Absent";
            }
          }

          let entryBadge = s.entry ? `<span class="entry-badge">‚úî ${new Date(s.entry).toLocaleTimeString()}</span>` : "";
          let exitBadge = s.exit ? `<span class="exit-badge">‚úî ${new Date(s.exit).toLocaleTimeString()}</span>` : "";
          let statusBadge = "";
          if(s.status==="Present"){
            statusBadge = `<span class="tick">‚úî Present</span>`;
          } else if(s.status==="Pending"){
            statusBadge = `<span style="color:orange;font-weight:bold;">‚è≥ In Class</span>`;
          } else {
            statusBadge = `<span class="cross">‚úñ Absent</span>`;
          }

          tbody.innerHTML += `
            <tr>
              <td>${s.name}</td>
              <td>${s.roll}</td>
              <td>${entryBadge}</td>
              <td>${exitBadge}</td>
              <td>${statusBadge}</td>
            </tr>
          `;
        });
      });
    }
  </script>
</body>
</html>
