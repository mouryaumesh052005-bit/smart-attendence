<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ğŸ“Œ Smart Attendance System</title>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Roboto:wght@400;500&display=swap" rel="stylesheet">

<style>
/* ğŸ”¥ Background Animation */
body {
    font-family:"Poppins", sans-serif;
    background: linear-gradient(-45deg, #ff9a9e, #fad0c4, #a1c4fd, #c2e9fb);
    background-size: 400% 400%;
    animation: gradient 15s ease infinite;
    margin:0;
    padding:20px;
    color:#222;
}
@keyframes gradient {
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
h1,h2{
    text-align:center;
    margin:10px 0;
    font-weight:600;
    color:#1f2937;
}

/* ğŸ”¥ Glass Card */
.card{
    background:rgba(255,255,255,0.85);
    border-radius:20px;
    padding:25px;
    box-shadow:0 8px 32px rgba(0,0,0,0.15);
    backdrop-filter:blur(12px);
    margin:20px auto;
    max-width:1000px;
    transition:0.3s;
}
.card:hover{box-shadow:0 12px 40px rgba(0,0,0,0.2);}

/* QR */
.qr-container{display:flex;justify-content:center;align-items:center;gap:25px;margin-bottom:25px;}
#qrcode{padding:18px;background:white;border-radius:18px;box-shadow:0 0 20px rgba(0,0,0,0.25);}

/* ğŸ”¥ Buttons */
button{
    padding:12px 22px;
    background:linear-gradient(90deg,#6366f1,#8b5cf6);
    color:white;
    border:none;
    border-radius:12px;
    cursor:pointer;
    font-weight:bold;
    font-size:15px;
    transition:0.3s;
}
button:hover{background:linear-gradient(90deg,#4f46e5,#4338ca);}
button.clear-btn{background:linear-gradient(90deg,#ef4444,#dc2626);}
button.clear-btn:hover{background:linear-gradient(90deg,#b91c1c,#7f1d1d);}

/* ğŸ”¥ Table */
.table-wrapper{max-height:550px;overflow-y:auto;}
table{
    width:100%;
    border-collapse:collapse;
    background:rgba(255,255,255,0.9);
    border-radius:14px;
    overflow:hidden;
    margin-top:20px;
}
th,td{padding:14px;text-align:center;border-bottom:1px solid #eee;word-wrap:break-word;font-size:14px;font-family:"Roboto";}
th{background:linear-gradient(90deg,#6366f1,#8b5cf6);color:white;}
tr:hover td{background:#f3f4f6;}

/* ğŸ”¥ Badges */
.entry-badge{color:white;background:#10b981;padding:6px 12px;border-radius:12px;font-weight:bold;display:inline-block;}
.exit-badge{color:white;background:#0ea5e9;padding:6px 12px;border-radius:12px;font-weight:bold;display:inline-block;}
.absent-badge{color:white;background:#ef4444;padding:6px 12px;border-radius:12px;font-weight:bold;display:inline-block;}
.tick{color:green;font-weight:bold;font-size:15px;}
.cross{color:red;font-weight:bold;font-size:15px;}
.pending{color:orange;font-weight:bold;font-size:15px;}

/* ğŸ”¥ Student Form */
.form-container{
    margin:30px auto;
    background:rgba(255,255,255,0.9);
    padding:30px;
    border-radius:20px;
    width:360px;
    box-shadow:0 6px 20px rgba(0,0,0,0.2);
}
input{
    width:92%;
    padding:12px;
    margin:12px 0;
    border:1px solid #ccc;
    border-radius:8px;
    font-size:15px;
    font-family:"Roboto";
}
@media screen and (max-width:600px){
    .qr-container{flex-direction:column;gap:20px;}
    .form-container{width:90%;}
}
</style>
</head>
<body>

<h1>ğŸ“Œ Smart Attendance System</h1>

<!-- Teacher Dashboard -->
<div id="teacher-view" class="card">
<h2>ğŸ‘¨â€ğŸ« Teacher Dashboard</h2>
<div class="qr-container">
<div id="qrcode"></div>
<div>
<button onclick="generateQR()">ğŸ”„ Generate QR</button><br><br>
<button class="clear-btn" onclick="clearRecords()">ğŸ—‘ Clear Records</button>
</div>
</div>
<div class="table-wrapper">
<table id="attendance-table">
<thead>
<tr>
<th>ğŸ‘¤ Name</th>
<th>ğŸ« Roll No</th>
<th>ğŸŸ¢ Entry</th>
<th>ğŸ”´ Exit</th>
<th>ğŸ“Š Attendance</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>

<!-- Student Form -->
<div id="student-view" class="form-container" style="display:none;">
<h2>ğŸ“ Attendance Form</h2>
<input type="text" id="name" placeholder="Enter Name" autofocus><br>
<input type="text" id="roll" placeholder="Enter Roll No"><br>
<button onclick="markAttendance()">âœ… Submit</button>
</div>

<script>
// ===== Firebase Setup =====
const firebaseConfig = {
  apiKey: "AIzaSyCI37gCUH4LvAH33bBly2bqA32Y0_0uaXE",
  authDomain: "smart-7c964.firebaseapp.com",
  databaseURL: "https://smart-7c964-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "smart-7c964",
  storageBucket: "smart-7c964.appspot.com",
  messagingSenderId: "22399720510",
  appId: "1:22399720510:web:a91e5bf63f0172ad48456f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== QR Code =====
const studentLink = window.location.origin + window.location.pathname + "?mode=student";
function generateQR(){
  document.getElementById("qrcode").innerHTML="";
  new QRCode(document.getElementById("qrcode"),{text:studentLink,width:220,height:220});
}
generateQR();

// ===== Detect Student Mode =====
const params = new URLSearchParams(window.location.search);
if(params.get("mode")==="student"){
  document.getElementById("teacher-view").style.display="none";
  document.getElementById("student-view").style.display="block";
  document.getElementById("name").focus(); // auto focus on name field
}

// ===== Load Attendance Table (Realtime) =====
function loadAttendance(){
  if(params.get("mode")==="student") return;
  db.ref("attendance").on("value", snapshot=>{
    const data = snapshot.val() || {};
    const tbody = document.querySelector("#attendance-table tbody");
    tbody.innerHTML = "";
    const now = Date.now();
    Object.values(data).forEach(s=>{
      if(!s.exit && s.entryTime && now - s.entryTime > 3000000){ // 50 mins
        s.status="Absent";
        db.ref("attendance/"+s.roll).update({status:"Absent"});
      }
      const entryBadge = s.entry ? `<span class="entry-badge">âœ” ${s.entry}</span>` : `<span class="absent-badge">âœ–</span>`;
      const exitBadge = s.exit ? `<span class="exit-badge">âœ” ${s.exit}</span>` : `<span class="absent-badge">âœ–</span>`;
      const statusHTML = s.status==="Present"?`<span class="tick">âœ” Present</span>`:s.status==="Absent"?`<span class="cross">âŒ Absent</span>`:`<span class="pending">â³ Pending</span>`;
      tbody.innerHTML += `<tr>
        <td>ğŸ‘¤ ${s.name}</td>
        <td>ğŸ« ${s.roll}</td>
        <td>${entryBadge}</td>
        <td>${exitBadge}</td>
        <td>${statusHTML}</td>
      </tr>`;
    });
  });
}
loadAttendance();

// ===== Mark Attendance =====
function markAttendance(){
  const name = document.getElementById("name").value.trim();
  const roll = document.getElementById("roll").value.trim();
  if(!name || !roll){ alert("âŒ Fill all details"); return; }
  const time = new Date().toLocaleTimeString();
  const timestamp = Date.now();
  const studentRef = db.ref("attendance/"+roll);

  studentRef.once("value").then(snapshot=>{
    const data = snapshot.val();
    let message = "";
    if(!data){
      studentRef.set({name, roll, entry:time, entryTime:timestamp, exit:"", status:"Pending"});
      message = "âœ… Entry Recorded, Attendance Pending â³";
    } else if(!data.exit){
      studentRef.update({exit:time, status:"Present"});
      message = "âœ… Exit Recorded, Attendance Present âœ”";
    } else {
      message = "â„¹ Already Submitted";
    }
    alert(message);
    document.getElementById("name").value="";
    document.getElementById("roll").value="";
    document.getElementById("name").focus();
  });
}

// ===== Clear Records =====
function clearRecords(){
  if(confirm("âš  Clear all records?")){
    db.ref("attendance").remove();
  }
}
</script>
</body>
</html>
